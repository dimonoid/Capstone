<!DOCTYPE HTML>
<!--
	Solid State by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>LP Page</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="{{url_for('static', filename='css/main.css')}}" />
		<noscript><link rel="stylesheet" href="{{url_for('static', filename='css/noscript.css')}}" /></noscript>

		<!--Leaflet JS & CSS-->
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
		integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
		crossorigin=""/>
		<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
		integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
		crossorigin=""></script>
	</head>
	<body class="is-preload">

		<!-- Page Wrapper -->
			<div id="page-wrapper">

				<!-- Header -->
					<header id="header">
						<h1><a href="{{ url_for('index') }}">CrimaVision</a></h1>
						<nav>
							<a href="#menu">Menu</a>
						</nav>
					</header>

				<!-- Menu -->
					<nav id="menu">
						<div class="inner">
							<h2>Menu</h2>
							<ul class="links">
								<li><a href="{{ url_for('index') }}">Home</a></li>
								<li><a href="{{ url_for('lpPage') }}">License Plate Recognition</a></li>
								<li><a href="{{ url_for('fPage') }}">Facial Recognition</a></li>
								<li><a href="#">Log In</a></li>
								<li><a href="#">Sign Up</a></li>
							</ul>
							<a href="#" class="close">Close</a>
						</div>
					</nav>

				<!-- Wrapper -->
					<section id="wrapper">
						<header>
							<div class="inner">
								<h2>License Plate Detection</h2>
								<input type="file" accept="image/*" name="image" id="file" style="display: none">
								<label for="file">Upload</label>
								
								<form method = "post" enctype="multipart/form-data">
									{{ form.hidden_tag() }}

									{% for error in form.photo.errors %}
										<span style="color: red;">{{ error }}</span>
									{% endfor %}
									<ul class="actions fit">
										<li><a href="#" class="button fit">{{ form.photo() }}</a></li>
										<li><a href="#" class="button primary">{{ form.submit(class="button primary") }}</a></li> 
									</ul>
									<div>
										{% if file_url %}
											<div>
												<img src="{{ file_url }}" style="width: 400px;">
											</div>
										{% endif %}
									</div>
								</form>
								<div class="inner">
									<ul class="actions">
										<li><p> Detected license plate : <b>{{ display_lpResult }}</b>
											<br> Owner : <b>{{ display_oResult }}</b>
											<br> Information : <b>{{ display_iResult }}</b>
											
											
											<div class="alert">
												<span class="closebtn" id="button primary" onclick="this.parentElement.style.display='none';">&times; </span>
												New Car Deteced.
											</div>
										</p>
										</li>
								
									</ul>
								</div>
								<section>
									<h3 class="major">Crime Map</h3>
									<div class ="inner">
										<button onclick="getLocation()">Get Location</button>
										<p id="geoLocationResult" style="margin-top: 15px; margin-left: 15px;"></p>
										<p id="geoLocationAddress" style="margin-left: 15px;"></p>
									
										<div id="map" style="height:480px;"></div> 

										<script>
											var x = document.getElementById("geoLocationResult");
											var y = document.getElementById("geoLocationAddress");
	
											function getLocation() {
												if (navigator.geolocation) {
													navigator.geolocation.getCurrentPosition(showPosition);
												} else { 
													x.innerHTML = "Geolocation is not supported by this browser.";
												}
											}
	
											function showPosition(position) {
												//Obtain current [longitude, latitude] from API
												var currentLong = position.coords.longitude;
												var currentLat = position.coords.latitude;
												
												//Reverse Geocoding (Coords --> Address)
												var requestOptions = {
													method: 'GET',
												};

												var reverseString = 'https://api.geoapify.com/v1/geocode/reverse?lat=' + currentLat + '&lon='+ currentLong + '&apiKey=cc4fed27d2764f9fb268f29c19c73959';

												fetch(reverseString).then(result => result.json())
												.then(featureCollection => {
													if (featureCollection.features.length === 0) {
														document.getElementById("status").textContent = "The address is not found";
														return;
													}
													const foundAddress = featureCollection.features[0];
													console.log(foundAddress.properties);
													console.log(foundAddress.properties.address_line1);
													y.innerHTML = "<b>Current location:</b> " + foundAddress.properties.address_line1 + ", " + foundAddress.properties.address_line2;
												});
												

												x.innerHTML = "<b>Latitude:</b> " + currentLat + ", <b>Longitude:</b> " + currentLong + "<br>" ;
								
												//Javascript for the Leaflet map
												var map = L.map('map', {center: [currentLat, currentLong], zoom: 19});
												L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
													maxZoom: 19,
													attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
												}).addTo(map)
												
												var currentLocationMarker = L.marker([currentLat, currentLong]).addTo(map)
													.bindPopup('Current location.')
													.openPopup();


												//Creating dummy markers/events on the map

												//45.390731, -75.744219
												var dummy1 = L.marker([45.390731, -75.744219]).addTo(map)
													.bindPopup('Parking Violation.')

												//45.428816, -75.691114
												var dummy2 = L.marker([45.428816, -75.691114]).addTo(map)
													.bindPopup('Vehicle Stolen.')

												//45.417656, -75.690743
												var dummy3 = L.marker([45.417656, -75.690743]).addTo(map)
													.bindPopup('Candy Theft.')

												//45.423235, -75.677401
												var dummy4 = L.marker([45.423235, -75.677401]).addTo(map)
													.bindPopup('Speeding Violation.')
												
												//45.420499, -75.673602
												var dummy5 = L.marker([45.420499, -75.673602]).addTo(map)
													.bindPopup('Kidnapping.')
											}

		
										</script>
									</div>
							
									</section>
								</section>
							</div>
							<!-- Potential future feature (List of active incidents)

							<div class="inner">
								<br><br>
								<h3 class="major">Active incidents</h3>
								<table>
									<tr>
									  <th>Incident</th>
									  <th>Location</th>
									  <th>Status</th>
									</tr>
									
									<tr>
									  <td>Theft</td>
									  <td>[45.390731, -75.744219]</td>
									  <td></td>
									</tr>
									<tr>
									  <td>Centro comercial Moctezuma</td>
									  <td>Francisco Chang</td>
									  <td>Officer at location</td>
									</tr>
									<tr>
										<td>Centro comercial Moctezuma</td>
										<td>Francisco Chang</td>
										<td>Mexico</td>
									</tr>
									<tr>
										<td>Centro comercial Moctezuma</td>
										<td>Francisco Chang</td>
										<td>Mexico</td>
									</tr>  
									<tr>
										<td>Centro comercial Moctezuma</td>
										<td>Francisco Chang</td>
										<td>Mexico</td>
									</tr>
								  </table>
							</div>
						</header>
					</section>
					-->



				<!-- Footer -->
					<section id="footer">
					</section>
			</div>




		<!-- Scripts -->
			<script src="{{url_for('static', filename='js/jquery.min.js')}}"></script>
			<script src="{{url_for('static', filename='js/jquery.scrollex.min.js')}}"></script>
			<script src="{{url_for('static', filename='js/browser.min.js')}}"></script>
			<script src="{{url_for('static', filename='js/breakpoints.min.js')}}"></script>
			<script src="{{url_for('static', filename='js/util.js')}}"></script>
			<script src="{{url_for('static', filename='js/main.js')}}"></script>
			<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
			<script type=text/javascript>
      		  $(function() {
         		 $('a#test').on('click', function(e) {
           			 e.preventDefault()
           			 $.getJSON("/displayLocation",
              		  function(data) {
             	 //do nothing
            });
            return false;
         		 });
       			 });
			</script>
	</body>
</html>